.segment "EXTRA"

TESTVAR:
   JSR PRINT_VAR
   INC TXTPTR
   JSR PRINT_VAR

   RTS


PRINT_VAR:
   JSR FRMEVL
   JSR FOUT
   TYA 
   TAX
TESTVAR_NEXT_CHR:
   LDA $0100,X
   BEQ TESTVAR_EXIT
   JSR ECHO
   INX
   JMP TESTVAR_NEXT_CHR
TESTVAR_EXIT:
   JSR LFCR
   RTS

LOAD:
  LDX #$02
  JSR CHRGOT
LOADNEXT:
  BEQ DOLOAD
  STA CMD,X
  JSR CHRGET 
  INX
  JMP LOADNEXT

DOLOAD:
  JSR sd_init
  BCS LOADFAIL
  JSR fat32_init
  BCS LOADFAIL
  LDA #$01
  STA R_OS_4
  JSR LOADFILE

  LDA #$01
  STA R_OS_3

  JSR LFCR
  
  RTS

LOADFAIL:
  LDA #'F'
  JSR ECHO
  LDA #'A'
  JSR ECHO
  LDA #'I'
  JSR ECHO
  LDA #'L'
  JSR ECHO
  JSR LFCR
  
  RTS

RETVAL:
  JSR FRMEVL
  JSR FOUT
  TYA
  TAX

  RTS

LOCATE:
   JSR RETVAL
   LDA $0100,X
   STA CURSOR_X   
   INX
   LDA $0100,X
   CMP #$00
   BEQ X_SDIG
   STA CURSOR_X+1

   JMP LOC_Y
X_SDIG:
   LDA CURSOR_X
   STA CURSOR_X+1
   LDA #$00
   STA CURSOR_X

LOC_Y:
   INC TXTPTR ; move past separator value

   JSR RETVAL
   LDA $0100,X
   STA CURSOR_Y
   INX
   LDA $0100,X
   CMP #$00
   BEQ Y_SDIG
   STA CURSOR_Y+1

   JMP LOC_SYSCALL
Y_SDIG:
   LDA CURSOR_Y
   STA CURSOR_Y+1
   LDA #$00
   STA CURSOR_Y

LOC_SYSCALL:
   LDX #$06
   STX BIOS_SYSCALL_N
   JSR BIOS_SYSCALL
 
   RTS


FGCOLOR:
   JSR RETVAL
   LDA $0100,X
   STA FG_COLOR
   INX
   LDA $0100,X
   STA FG_COLOR+1

   LDX #$01
   STX BIOS_SYSCALL_N
   JSR BIOS_SYSCALL

   RTS

BGCOLOR:
   JSR RETVAL
   LDA $0100, X
   STA BG_COLOR
   INX
   LDA $0100, X
   STA BG_COLOR+1

   LDX #$02
   STX BIOS_SYSCALL_N
   JSR BIOS_SYSCALL
 
   RTS

SETTEXT:
   JSR RETVAL
   LDA $0100,X
   SEC
   SBC #$30
   TAY
   INX
   LDA $0100,X
   CMP #$00
   BEQ SETTEXT_SYSCALL

   SEC
   SBC #$30
SETTEXT_ADD_TEN:
   CLC
   ADC #$0A
   DEY
   CPY #$00
   BNE SETTEXT_ADD_TEN
   TAY

SETTEXT_SYSCALL:
   TYA
   STA TEXT_FLAGS
   LDX #$03
   STX BIOS_SYSCALL_N
   JSR BIOS_SYSCALL

   RTS
   

